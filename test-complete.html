<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Test - Northern Facilities Group</title>
    <link rel="stylesheet" href="./style.css" />
    <script src="nav-loader.js"></script>
</head>
<body>
    <h1>Complete Test Page</h1>
    <p>Testing all the fixes for the JavaScript errors...</p>
    
    <!-- Navigation container -->
    <div id="nav-placeholder"></div>
    
    <!-- Test buttons -->
    <button id="testNavScroll">Test Nav Scroll</button>
    <button id="testModal">Test Modal</button>
    
    <!-- Test modal -->
    <div id="quoteModal" class="modal" aria-hidden="true">
        <div class="modal-overlay" data-close="true"></div>
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="quoteTitle">
            <button id="closeModal" class="modal-close" aria-label="Close">×</button>
            <h3 id="quoteTitle">Test Modal</h3>
            <p>This is a test modal to verify the JavaScript is working correctly.</p>
        </div>
    </div>
    
    <div id="status"></div>
    
    <script>
        const statusEl = document.getElementById('status');
        
        function log(message, isError = false) {
            console.log(message);
            const p = document.createElement('p');
            p.textContent = new Date().toLocaleTimeString() + ': ' + message;
            p.style.color = isError ? 'red' : 'green';
            statusEl.appendChild(p);
        }
        
        // Test 1: Load navigation
        async function testNavigation() {
            try {
                log('Testing navigation loading...');
                const res = await fetch('./partials/nav.html/nav.html');
                if (!res.ok) throw new Error('Failed to fetch nav: ' + res.status);
                
                const html = await res.text();
                const mount = document.getElementById('nav-root');
                mount.innerHTML = html;
                
                const nav = document.querySelector('.nav');
                if (nav) {
                    log('✓ Navigation loaded successfully');
                    return true;
                } else {
                    throw new Error('Nav element not found in loaded HTML');
                }
            } catch (e) {
                log('✗ Navigation loading failed: ' + e.message, true);
                return false;
            }
        }
        
        // Test 2: Test nav scroll function
        function testNavScroll() {
            try {
                log('Testing nav scroll function...');
                const nav = document.querySelector('.nav');
                if (!nav) {
                    throw new Error('Nav element not found');
                }
                
                // Simulate scroll
                window.scrollTo(0, 100);
                setTimeout(() => {
                    if (nav.classList.contains('scrolled')) {
                        log('✓ Nav scroll effect working');
                    } else {
                        log('✗ Nav scroll effect not working', true);
                    }
                }, 100);
            } catch (e) {
                log('✗ Nav scroll test failed: ' + e.message, true);
            }
        }
        
        // Test 3: Test modal functionality
        function testModal() {
            try {
                log('Testing modal functionality...');
                const modal = document.getElementById('quoteModal');
                if (!modal) {
                    throw new Error('Modal not found');
                }
                
                modal.classList.add('active');
                if (modal.classList.contains('active')) {
                    log('✓ Modal can be opened');
                    
                    // Test closing
                    setTimeout(() => {
                        modal.classList.remove('active');
                        if (!modal.classList.contains('active')) {
                            log('✓ Modal can be closed');
                        }
                    }, 500);
                } else {
                    log('✗ Modal cannot be opened', true);
                }
            } catch (e) {
                log('✗ Modal test failed: ' + e.message, true);
            }
        }
        
        // Run tests
        async function runAllTests() {
            log('Starting comprehensive tests...');
            
            const navLoaded = await testNavigation();
            
            document.getElementById('testNavScroll').addEventListener('click', testNavScroll);
            document.getElementById('testModal').addEventListener('click', testModal);
            
            if (navLoaded) {
                // Test nav scroll after a short delay
                setTimeout(testNavScroll, 1000);
            }
            
            testModal();
            
            log('All tests completed!');
        }
        
        // Start tests when DOM is ready
        document.addEventListener('DOMContentLoaded', runAllTests);
    </script>
    
    <!-- Load the main script to test for errors -->
    <script src="./script.js" defer></script>
</body>
</html>
